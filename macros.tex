\def\true{true}
\def\false{false}
\def\vertical{vertical}
\def\horizontal{horizontal}

\def\pointborderrectanglecorners#1#2#3{%point, southwest, northeast
    \pgf@process{#2}
    \pgf@xa = \pgf@x
    \pgf@ya = \pgf@y
    \pgf@process{#3}
    \pgf@xb = \pgf@x
    \pgf@yb = \pgf@y
    \pgf@xc = 0.5\pgf@xa
    \advance\pgf@xc by 0.5\pgf@xb
    \pgf@yc = 0.5\pgf@ya
    \advance\pgf@yc by 0.5\pgf@yb
    \pgf@process{#1}
    \advance\pgf@xb by -\pgf@xc
    \advance\pgf@yb by -\pgf@yc
    \pgf@xa = \pgf@x
    \pgf@ya = \pgf@y
    \pgf@process{\pgfpointborderrectangle{\pgfpoint{\pgf@xa}{\pgf@ya}}{\pgfpoint{\pgf@xb}{\pgf@yb}}}
    \advance\pgf@x by \pgf@xc
    \advance\pgf@y by \pgf@yc
}

\def\pointbordercircle#1#2#3{%point, center, radius
    \pgf@process{#2}
    \pgf@xc = \pgf@x
    \pgf@yc = \pgf@y
    \pgf@process{#1}
    \pgf@xa = \pgf@x
    \pgf@ya = \pgf@y
    \pgf@xb = #3
    \pgf@yb = #3
    \edef\pgf@marshal{%
        \noexpand\pgfpointborderellipse
        {\noexpand\pgfpoint{\the\pgf@xa}{\the\pgf@ya}}
        {\noexpand\pgfpoint{\the\pgf@xb}{\the\pgf@yb}}%
    }
    \pgf@process{\pgf@marshal}
    \advance\pgf@x by \pgf@xc
    \advance\pgf@y by \pgf@yc
}

\def\circlefindx#1#2#3#4{
    \pgf@process{#1}
    \pgf@xc=\pgf@x
    \pgf@yc=\pgf@y
    \pgf@xb=#2
    \pgf@y=#3
    \advance\pgf@y by -\pgf@yc
    \pgfmathsetlength{\pgf@x}{sqrt(\pgf@xb^2-\pgf@y^2)}
    \ifnum #4=1
        \pgf@x=-\pgf@x
    \fi
    \advance\pgf@x by \pgf@xc
}

\def\circlefindangle#1#2#3#4{%center, radius, y, sol
    \pgf@process{#1}
    \pgf@xc=\pgf@x
    \pgf@yc=\pgf@y
    \pgf@xb=#2
    \pgf@y=#3
   \advance\pgf@y by -\pgf@yc
    \pgfmathsetlength{\pgf@x}{sqrt(\pgf@xb^2-\pgf@y^2)}
    \ifnum #4=1
        \pgf@x=-\pgf@x
    \fi
    % \pgfmathsetlength{\pgf@x}{atan2(\pgf@y,\pgf@x)}
    \pgfmathsetlength{\pgf@x}{round(atan2(\pgf@y,\pgf@x))}
}

\def\belongstocone#1#2#3#4{%center, point1, point2, point
    % \global\if@tempswa
    \pgf@process{#1}
    \pgf@xc=\pgf@x
    \pgf@yc=\pgf@y
    \pgf@process{#2}
    \advance\pgf@x by -\pgf@xc
    \advance\pgf@y by -\pgf@yc
    \pgfmathsetlength{\pgf@xa}{atan2(\pgf@y,\pgf@x)}
    \ifdim\pgf@xa<0pt
        \advance\pgf@xa by 360pt
    \fi
    \pgf@process{#3}
    \advance\pgf@x by -\pgf@xc
    \advance\pgf@y by -\pgf@yc
    \pgfmathsetlength{\pgf@xb}{atan2(\pgf@y,\pgf@x)}
    \ifdim\pgf@xb<0pt
        \advance\pgf@xb by 360pt
    \fi
    \pgf@process{#4}
    \advance\pgf@x by -\pgf@xc
    \advance\pgf@y by -\pgf@yc
    \pgfmathsetlength{\pgf@ya}{atan2(\pgf@y,\pgf@x)}
    \ifdim\pgf@ya<0pt
        \advance\pgf@ya by 360pt
    \fi
    \ifdim\pgf@ya>\pgf@xa
        \global\@tempswafalse
    \else
        \ifdim\pgf@ya<\pgf@xb
            \global\@tempswafalse
        \else
            \global\@tempswatrue
        \fi
    \fi
}
