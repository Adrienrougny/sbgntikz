\pgfdeclareshape{macromolecule}{

    \inheritsavedanchors[from=rectangle] % this is nearly a rectangle
    \inheritanchorborder[from=rectangle]

    \foreach \a in {center, north, south, west, east, south east, south west, north east, north west}
    {
        \inheritanchor[from=rectangle]{\a}
    }

    \backgroundpath{
        \def\scarce{0.038}
        \pgf@process{\southwest}
        \pgf@xa = \pgf@x
        \pgf@ya = \pgf@y
        \pgf@process{\northeast}
        \pgf@xb = \pgf@x
        \pgf@yb = \pgf@y
        \pgf@xc = \pgfkeysvalueof{/pgf/outer xsep}
        \pgf@yc = \pgfkeysvalueof{/pgf/outer ysep}
        \advance\pgf@xa by \pgf@xc
        \advance\pgf@xb by -\pgf@xc
        \advance\pgf@ya by \pgf@yc
        \advance\pgf@yb by -\pgf@yc
        \newdimen\width
        \pgfmathsetlength{\width}{\pgf@xb-\pgf@xa}
        \newdimen\height
        \pgfmathsetlength{\height}{\pgf@yb-\pgf@ya}

        \pgfsetcornersarced{\pgfpoint{\scarce*\width}{\scarce*\width}}
        \pgf@xc = \pgf@xa \pgf@yc = \pgf@yb
        \pgfpathmoveto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfmathsetlength{\pgf@xc}{\pgf@xa+\width}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfmathsetlength{\pgf@yc}{\pgf@yb-\height}
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgf@xc=\pgf@xa
        \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
        \pgfpathclose
    }

    \foregroundpath{
        \pgfkeysgetvalue{/pgf/clone}{\clone}
        \ifx\clone\true
            \def\cloneoffset{0.25}
            \def\scarce{0.038}
            \pgf@process{\southwest}
            \pgfgetlastxy{\xa}{\ya}
            \pgf@process{\northeast}
            \pgfgetlastxy{\xb}{\yb}
            \newdimen\width
            \pgfmathsetlength{\width}{\xb-\xa}
            \newdimen\height
            \pgfmathsetlength{\height}{\yb-\ya}

            \pgfsetcornersarced{\pgfpointorigin}
            \pgfmathsetlength{\pgf@xc}{\xa}
            \pgfmathsetlength{\pgf@yc}{\ya+\cloneoffset*\height}
            \pgfpathmoveto{\pgfpoint{\pgf@xc}{\pgf@yc}}
            \pgf@xc = \xb
            \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
            \pgf@yc = \ya
            \pgfsetcornersarced{\pgfpoint{\scarce*\width}{\scarce*\width}}
            \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
            \pgf@xc = \xa
            \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
            \pgfsetcornersarced{\pgfpointorigin}
            \pgfpathclose
            \pgfsetfillcolor{\tikz@strokecolor}
            \pgfusepath{stroke, fill}
        \fi
    }
}
